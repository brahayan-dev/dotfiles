#!/usr/bin/env bash

# Function to ping the workspace
ping() {
    ansible -i hosts.ini Workspace -c local -m ping
}

# Function to install and use ansible-playbook
setup() {
    local OS
    OS="$(uname -a)"

    if [[ $OS =~ Darwin ]]; then
        echo "============= Running Darwin Playbook ============="
        [ ! -e /opt/homebrew/bin/ansible ] && brew install ansible
        ansible-playbook -i hosts.ini -c local -K darwin.yml
    fi

    if [[ $OS =~ Linux ]]; then
        echo "============= Running Linux Playbook ============="
        [ ! -e /usr/bin/ansible ] && dnf install ansible
        ansible-playbook -i hosts.ini -c local -K linux.yml
    fi
}

# Main script logic
case "$1" in
"ping")
    ping
    ;;
"setup")
    setup
    ;;
*)
    echo "Usage: $0 {ping|setup}"
    exit 1
    ;;
esac
